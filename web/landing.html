<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Stabilis - Project Hub</title>
    <link rel="stylesheet" href="css/landing.css">
</head>

<body>
    <div class="landing-container">
        <!-- Compact Header -->
        <header class="hero">
            <div class="hero-content">
                <div class="logo">STABILIS</div>
                <h1 class="hero-title">Project Hub</h1>
                <div class="hero-actions">
                    <button class="new-user-btn" onclick="startNewUserFlow()">I am new here</button>
                </div>
                <div class="user-info" id="user-info" style="display: none; margin-top: 0.5rem;">
                    <span id="username-display"></span>
                    <button onclick="showChangePasswordModal()" class="icon-btn" title="Change Password">üîí</button>
                    <button onclick="logoutUser()" class="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <!-- Compact Project Buttons -->
        <main class="projects-section">
            <div class="project-buttons">
                <a href="turnaround.html" class="project-btn turnaround">
                    <div class="btn-icon">üö®</div>
                    <div class="btn-content">
                        <div class="btn-title">Financial Health<br>& Turnaround</div>
                        <div class="btn-badge priority-1">PRIORITY 1</div>
                    </div>
                </a>

                <a href="index.html" class="project-btn diversification">
                    <div class="btn-icon">üìà</div>
                    <div class="btn-content">
                        <div class="btn-title">Service<br>Diversification</div>
                        <div class="btn-badge priority-2">PRIORITY 2</div>
                    </div>
                </a>

                <a href="wellness.html" class="project-btn wellness">
                    <div class="btn-icon">üíö</div>
                    <div class="btn-content">
                        <div class="btn-title">Wellness<br>Centre</div>
                        <div class="btn-badge priority-3">PRIORITY 3</div>
                    </div>
                </a>
            </div>

            <!-- Strategic Triangle Info -->
            <div class="strategic-triangle">
                <div class="triangle-icon">üí°</div>
                <h3>Strategic Triangle</h3>
                <p class="triangle-desc">
                    <strong class="text-danger">Turnaround</strong> fixes the holes ‚Üí
                    <strong class="text-primary">Diversification</strong> upgrades the engine ‚Üí
                    <strong class="text-success">Wellness Centre</strong> builds the highway for long-term growth.
                </p>
                <p class="triangle-note">
                    The Turnaround Project must stabilize operations before Diversification and Wellness can scale
                    safely.
                    This creates the foundation for sustainable expansion across all three initiatives.
                </p>
            </div>

            <!-- Minimal Overview -->
            <div class="overview-compact">
                <div class="overview-stat">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span class="stat-text">25+ Months</span>
                </div>
                <div class="overview-stat">
                    <span class="stat-icon">üéØ</span>
                    <span class="stat-text">76 Milestones</span>
                </div>
                <div class="overview-stat">
                    <span class="stat-icon">üí∞</span>
                    <span class="stat-text">R10m+ Impact</span>
                </div>
            </div>
        </main>

        <!-- Minimal Footer -->
        <footer class="landing-footer">
            <p>&copy; 2025 Stabilis</p>
        </footer>
    </div>

    <script src="js/auth.js?v=1.1.2"></script>
    <script src="js/pwa-install.js?v=1.1.2"></script>
    <script>
        // Version management - force sign out on version changes but preserve passwords
        const APP_VERSION = '1.1.2'; // Increment this when deploying new versions
        const VERSION_KEY = 'stabilis-app-version';
        const PASSWORDS_KEY = 'stabilis-passwords'; // Separate storage for passwords

        function checkVersion() {
            const storedVersion = localStorage.getItem(VERSION_KEY);
            if (storedVersion && storedVersion !== APP_VERSION) {
                // Version changed - preserve passwords but clear user session
                console.log(`Version updated from ${storedVersion} to ${APP_VERSION}`);
                const passwords = localStorage.getItem(PASSWORDS_KEY);
                localStorage.removeItem('stabilis-user'); // Force re-login
                if (passwords) {
                    localStorage.setItem(PASSWORDS_KEY, passwords); // Preserve passwords
                }
            }
            localStorage.setItem(VERSION_KEY, APP_VERSION);
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkVersion();
            initAuth();
            const params = new URLSearchParams(window.location.search);
            const stayOnLanding = params.get('stay') === '1';
            const currentUser = JSON.parse(localStorage.getItem('stabilis-user') || '{}');
            const executiveUsers = window.EXECUTIVE_USERS || ['Developer', 'Attie Nel', 'Nastasha Jackson', 'Lydia Gittens', 'Berno Paul'];
            if (!stayOnLanding && currentUser.name && executiveUsers.includes(currentUser.name)) {
                window.location.href = 'executive-dashboard.html';
            }
        });
    </script>
</body>

</html>